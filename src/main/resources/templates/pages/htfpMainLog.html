<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="">
		<title>DView8-TFTP-tool</title>
		<link rel="shortcut icon" href="../images/favicon.ico" >
		<link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet">
		<link href="../vendor/datatables-plugins/dataTables.bootstrap.css" rel="stylesheet">
		<link href="../vendor/datatables-responsive/dataTables.responsive.css" rel="stylesheet">
		<link href="../vendor/dist/css/sb-admin-2.css" rel="stylesheet">
		<link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	</head>

	<body>

				<div class="row">
					<div class="col-lg-12">
						<div class="panel panel-default">
							<div class="panel-heading">
								Log viewer
							</div>
							<!-- /.panel-heading -->
							<div class="panel-body">
								<table width="100%" class="table table-striped table-bordered table-hover dataTable myTable" id="dataTables-examples">
									<thead>
										<tr>
											<th>Name</th>
											<th>Position</th>
											<th>Office</th>
											<th>Extn.</th>
											<th>Start date</th>
											<th>Salary</th>
										</tr>
									</thead>
								</table>
							</div>
						</div>
					</div>
				</div>


		
		<script src="../vendor/jquery/jquery.min.js"></script>
		<script src="../vendor/bootstrap/js/bootstrap.min.js"></script>
		<script src="../vendor/metisMenu/metisMenu.min.js"></script>
		<script src="../vendor/datatables/js/jquery.dataTables.min.js"></script>
		<script src="../vendor/datatables-plugins/dataTables.bootstrap.min.js"></script>
		<script src="../vendor/datatables-responsive/dataTables.responsive.js"></script>
		<script>
			$(document).ready(function() {
				var dataSet = [
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', '123242412', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X'],
					['Trident', 'Internet Explorer 4.0', 'Win 95+', '4', 'X', 'X']
				];

				$('#dataTables-examples').DataTable({
					"scrollY": "200px",
					"paging": true,
					"ordering": false,
					"info": true,
					"searching": false,
					"data": dataSet,
					"language": {
						"lengthMenu": "_MENU_ 条记录每页",
						"zeroRecords": "没有找到记录",
						"info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
						"infoEmpty": "无记录",
						"infoFiltered": "(从 _MAX_ 条记录过滤)",
						"paginate": {
							"previous": "上一页",
							"next": "下一页"
						}
					},
				});
			});

			$(function() {
				//初始化证照属性设置表
				initnewAttributeTable();
			});

			//证照属性设置表

			function initnewAttributeTable() {
				var table = $('#newAttributeTable').dataTable({
					"paging": true, //翻页
					//"bPaginate" : true,      //显示分页器
					//"iDisplayLength":28,
					"ordering": false,
					"searching": true, //搜索框
					//"bLengthChange":true,//改变每行显示数据数量
					//"aLengthMenu": [[10, 30, 50, -1], [10, 30, 50, "All"]],
					"bInfo": true, //页脚
					'bStateSave': true,
					"bAutoWidth": false,
					"bSort": true,
					"processing": false,
					"serverSide": false,
					"sServerMethod": "get", //post
					"bDestroy": true,
					"ajax": {
						"url": encodeURI("${pageContext.request.contextPath}/ajax/certificate/getCertificateTypeList"),
						//"dataSrc": "data",//默认为data
						"type": "get",
						"error": function() {}
					},
					"columns": [{
						"data": null,
						"title": "序号",
						"sWidth": "30px",
						"sClass": "text-tables-center",
						"createdCell": function(nTd, sData, oData, iRow, iCol) {
							var startnum = this.api().page() * (this.api().page.info().length);
							$(nTd).html(iRow + 1 + startnum); //分页行号累加：$(nTd).html(iRow+1);
						}
					}, {
						"data": "typeName",
						"title": "证照属性设置"
					}, {
						"data": "typeNamess",
						"title": "证照属性xx设置"
					}, {
						"data": "typeNames",
						"title": "证照属性x设置"
					},{
						"data": null,
						"title": "操作"
					}],
					"columnDefs": [{
							"targets": [1],
							"data": "typeName",
							"render": function(data, type, row) {
								//isLockStatus:true：显示有锁   false:显示没有锁
								if(row.isLockStatus == true) {
									return "" + row.typeName + "&nbsp;&nbsp;<i class='fa fa-lock l-fa' style='cursor: pointer'></i>";
								} else {
									return row.typeName;
								}
							}
						},{
							"targets": [2],
							"data": "typeNamess",
							"render": function(data, type, row) {
								//isLockStatus:true：显示有锁   false:显示没有锁
								if(row.isLockStatus == true) {
									return "" + row.typeName + "&nbsp;&nbsp;<i class='fa fa-lock l-fa' style='cursor: pointer'></i>";
								} else {
									return row.typeName;
								}
							}
						},{
							"targets": [3],
							"data": "typeNames",
							"render": function(data, type, row) {
								//isLockStatus:true：显示有锁   false:显示没有锁
								if(row.isLockStatus == true) {
									return "" + row.typeName + "&nbsp;&nbsp;<i class='fa fa-lock l-fa' style='cursor: pointer'></i>";
								} else {
									return row.typeName;
								}
							}
						},
						{
							"targets": [4],
							"data": "id",
							"sWidth": "60px",
							"sClass": "text-tables-center",
							"render": function(data, type, row) {
								var id = row.id == undefined ? -1 : row.id; //-1说明是新增，其余表示为编辑
								if(row.isLockStatus == true) {
									return "-";
								} else {
									return "<i class='fa fa-pencil l-fa edit-btn' style='cursor: pointer' id=\'" + id + "\'></i>&nbsp;&nbsp;<i class='fa fa-trash-o m-fa del-btn' style='cursor: pointer' id=\'" + id + "\'></i>";
								}
							}
						}, {
							sDefaultContent: '',
							aTargets: ['_all']
						}
					]
				});

				//新增一行表格
				$("#newAttribute").unbind('click').click(function() {
//					if($("#newAttributeTable tbody tr:last td i").eq(0).attr('id') == -1) {
//						return;
//					}
					$('#newAttributeTable').dataTable().fnAddData([]);
					var nTrsLength = $("#newAttributeTable tbody tr").length;
					var nTrs = $("#newAttributeTable tbody tr").eq(nTrsLength - 1);
					var nIs = nTrs.find("td").eq(4).find("i").eq(0)
					nIs.click();
				});
				//点击编辑图标出现编辑框
				$("#newAttributeTable tbody").unbind('click').on("click", ".edit-btn", function() {
					var tds = $(this).parents("tr").children();
					var i;
					$.each(tds, function(i, val) {
						var jqob = $(val);
						var txt = jqob.text();
						if(i > 0 && i!=4) {
							var put = $("<input type='text' class='form-control' style='width:100%'>");
							put.val(txt);
							jqob.html(put);
						}
					});
					$(this).toggleClass("edit-btn fa-pencil");
					$(this).toggleClass("save-btn fa-save");
				});
				//保存按钮
				$("#newAttributeTable tbody").on("click", ".save-btn", function() {
					var id = $(this).attr("id");
					var tds = $(this).parents("tr").children();
					var sTds = tds.length;
					var lisval = [];
					for(var i = 0; i < sTds; i++) {
						if(i < sTds - 1)
							lisval.push(tds.eq(i).children("input").val());
						else lisval.push(tds.eq(i).children("input").val())
					}
					if(i == sTds - 1) lisval.push();
					if(lisval[1] == "") {
						toNotification("警告！", "证照属性设置不能为空！", "warning");
						return false;
					} else if(lisval[1].length > 10) {
						toNotification("警告！", "证照属性设置不能超过十个字符！", "warning");
						return false;
					} else {
						$.each(tds, function(i, val) {
							var jqob = $(val);
							//把input变为字符串
							if(!jqob.has('i').length) {
								var txt = jqob.children("input").val();
								jqob.html(txt);
							}
						});
						$(this).toggleClass("edit-btn fa-pencil");
						$(this).toggleClass("save-btn fa-save");
						//保存数据
						SaveData(lisval[1], id);
					}
				});

				//证照属性设置保存信息
				function SaveData(msg, id) {
					var data = {
						id: id, //-1表示是新增
						typeName: msg
					}
					var url = encodeURI("${pageContext.request.contextPath}/ajax/certificate/saveCertificateType");
					actionRequest(data, url, function(data) {
						if(data.successed) {
							toNotification("提示！", "操作成功！", "success");
							//刷新表格
							initnewAttributeTable();
						} else {
							toNotification("操作失败！", data.message, "error");
							//刷新表格
							initnewAttributeTable();
						}
					});
				}

				//证照属性设置删除
				$("#newAttributeTable tbody").on("click", ".del-btn", function() {
					var id = $(this).attr("id");
					if(id == -1) {
						var trs = $(this).parents("tr");
						initnewAttributeTable();
						return false;
					} else {
						var tds = $(this).parents("tr").children();
						var data = { id: id };
						var url = "/ajax/certificate/deleteCertificateType";
						//执行删除
						toConfirm(data, url, function(data) {
							if(data.successed) {
								swal({
									title: "删除成功",
									text: "<small>1秒后自动关闭<small>",
									type: "success",
									html: true,
									timer: 1000
								});
								initnewAttributeTable();
							} else {
								swal("删除失败!", data.message, "error");
							}
						});
					}
				});
			}
			//获得标识
			function getActionId() {
				return new Date().getTime();
			}
		</script>

	</body>

</html>